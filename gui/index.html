<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>pyProClust: easy clustering for biomolecules</title>
    <link rel="stylesheet" type="text/css" href="css/ui-lightness/jquery-ui-1.10.0.custom.min.css"
      media="screen">
     <link href="css/jquery.tagit.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/basic.css"
      media="screen">
    <script type="text/javascript" src="js/jquery-1.9.0.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery-ui-1.10.0.custom.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery.ui.selectmenu.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/cluster_params_field_templating.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/query_and_eval.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/tag-it.min.js" charset="utf-8"></script>
    <script>
        function toggable_checkbox(this_widget, toggles_this_one, invert){
            if (!invert){
                $(this_widget).click(function() {
                    if($(this_widget).prop('checked')){
                        $(toggles_this_one).hide("blind");
                    }
                    else{
                        $(toggles_this_one).show("blind");
                    }
                });
            }
            else{
                $(this_widget).click(function() {
                    if(!$(this_widget).prop('checked')){
                        $(toggles_this_one).hide("blind");
                    }
                    else{
                        $(toggles_this_one).show("blind");
                    }
                });
            }
        }
        
        function toggable_radiobutton(radio1, radio2, toggles_this_one){
            $(radio1).click(function() {
                $(toggles_this_one).hide("blind")
            });

            $(radio2).click(function() {
                $(toggles_this_one).show("blind")
            });
        }
        
        function toggable_text(text_id, sign_image_id, toggles_this_one){
            $(text_id).click(function(){
                if ($(toggles_this_one).prop("hidden")){
                    $(sign_image_id).prop("src","images/expanded.png")
                    $(toggles_this_one).show("blind");
                    $(toggles_this_one).prop("hidden",false)
                }
                else{
                    $(sign_image_id)[0].src = "images/collapsed.png";   
                    $(toggles_this_one).hide("blind");
                    $(toggles_this_one).prop("hidden",true)
                }
            });
        }
        
        
        
        $(document).ready( function() {
            
            var clustering_algorithm_fields = { "GROMOS Algorithm":null, 
                                            "K-Medoids Algorithm":null,
                                            "Hierarchical Algorithm":null,
                                            "Spectral Algorithm":null,
                                            "DBSCAN Algorithm":null,
                                            "Random Algorithm":null};
            
            var clustering_algorithm_ids = {    "GROMOS Algorithm":"gromos", 
                                            "K-Medoids Algorithm":"kmedoids",
                                            "Hierarchical Algorithm":"hierarchical",
                                            "Spectral Algorithm":"spectral",
                                            "DBSCAN Algorithm":"dbscan",
                                            "Random Algorithm":"random"};
            
            var query_types = ["NumClusters", "NumClusteredElems", "MeanClusterSize",
                           "PercentInTop4", "PercentInTop", "Cohesion-Separation",
                           "NoiseLevel", "MirrorCohesion", "MinimumMeanSeparation",
                           "Silhouette", "CythonMirrorCohesion", "CythonMinimumMeanSeparation",
                           "CythonSilhouette", "RatioCut", "NCut",
                           "CythonNormNCut", "NormNCut", "MixMaxCut",
                           "PCAanalysis"]
            
            var query_types_dict = {}
                    
            for (clustering_algorithm_name in clustering_algorithm_fields){
                $("#algorithms_listbox").append("<option>"+clustering_algorithm_name+"</option>");
            }
            
            for (clustering_algorithm_id in clustering_algorithm_ids){
                $("#algorithms_field").append("<div id ='"+clustering_algorithm_id+"'/>");
            }
            
            for (var i = 0; i < query_types.length; i++){
                $("#query_listbox").append("<option>"+query_types[i]+"</option>");
                query_types_dict[query_types[i]] = 0;
            }
                       
                       
            generate_all_fields(clustering_algorithm_fields, clustering_algorithm_ids);
            
            // All widgets of class spinner_widget are converted to real sp. w.
            $( ".spinner_widget" ).spinner();
            //$( ".selection_widget" ).selectmenu();
            
            $(".button_widget").button();
            
            $(".tag_widget").tagit({availableTags: query_types,
                                    beforeTagAdded: function(event, ui) {
                                    console.log(ui);
                                        if (!(ui.tagLabel in query_types_dict)){
                                            return false;
                                        }
                                    }});
            
        dialog = jQuery("<div>",{
                            title: "Error",
                            text: "hello"
                        }).dialog({modal:true});            
                        
            /*$('input:text')
              .button()
              .css({
                      'font' : 'inherit',
                     'color' : 'inherit',
                'text-align' : 'left',
                   'outline' : 'none',
                    'cursor' : 'text'
              });*/
            
            $("#add_clustering_algorithm").button().click(function(){
                add_clustering_algorithm_field($("#algorithms_listbox").val(), 
                                                clustering_algorithm_fields,
                                                clustering_algorithm_ids, 
                                                "#algorithms_field");
            });
            
            $("#add_evaluation_criteria_button").click(function(){
                
            });
            
            $("#add_query_button").click(function(){
                //add_evalquery_blob($("#query_listbox").val(), "#query_container_field");
                $("#query_tags").tagit("createTag",$("#query_listbox").val());
            });

            toggable_checkbox('#matrix_calculation', "#load_matrix_field", false);

            toggable_checkbox('#matrix_save', "#save_matrix_field", true);

            toggable_radiobutton('#traj_radio_1', '#traj_radio_2', '#second_trajectory_field');

            toggable_text('#advanced_options_label','#advanced_options_sign',"#advanced_options_field");
            
        });
        
    </script>
  </head>
  <body> pyProClust<br>
    <br>
    <form method="POST" action="localhost:8000/create_script" name="all_parameters">
      
    <fieldset name="calculo_matriz"><legend>Distance Matrix Calculation</legend>
        <label for="calculo_matriz"> Calculate matrix </label>
        <input checked="checked" name="calcular_matriz" id="matrix_calculation" type="checkbox"><br>
        
        <div id="load_matrix_field" hidden="false"> Select a matrix file to
        load: <input name="matrix_path" type="file"></div>
        
        <div> Selection string:<input name="rmsd_selection" id="rmsd_selection"
        type="text"></div>
        
        <label for="matrix_calculation"> Save matrix </label><input name="guardar_matriz"
        id="matrix_save" type="checkbox">
        
        <div id="save_matrix_field" hidden="true"> Choose a location to save the
        matrix: <input name="store_matrix_path" type="file">
        </div>
        
    </fieldset>

    <fieldset name="datos_trayectorias"><legend>Trajectories</legend>
        <table border="0">
            <tbody>
                <tr>
                    <td>
                        <div> Single trajectory (clustering):</div>
                    </td>
                    <td>
                        <input id="traj_radio_1" value="1" name="number_of_trajectories"
                        checked="checked" type="radio">
                     </td>
                </tr>
                <tr>
                    <td>
                        <div> Two trajectories (comparison):</div>
                    </td>
                    <td>
                        <input id="traj_radio_2" value="1" name="number_of_trajectories"
                        type="radio">
                    </td>
                </tr> 
                <tr>
                    <td>
                        <div> First trajectory to load (pdb file):</div>
                    </td>
                    <td>
                        <input name="matrix_path" type="file">
                    </td>
                </tr>
                <tr id="second_trajectory_field" hidden="true">
                    <td>
                        <div> Second trajectory to load (pdb file):</div>
                    </td>
                    <td>
                        <input name="matrix_path" type="file"> 
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    
    <fieldset name="datos_clustering"><legend>Clustering</legend>
        <fieldset name="algorithms"><legend>Algorithms</legend>
            
            <table border="0">
            <tbody>
                <tr>
                    <td>
                        <div>Add</div>
                    </td>
                    <td>
                        <select class="selection_widget" id="algorithms_listbox">
                            
                        </select>
                    </td>
                    <td>
                        <div class="button_widget" id = "add_clustering_algorithm">+</div>
                    </td>
                </tr>
               
            </tbody>
            </table>
                <div id="algorithms_field">
                    <div id = "gromos_field"/> 
                    <div id = "kmedoids_field"/> 
                    <div id = "hierarchical_field"/>
                    <div id = "spectral_field"/> 
                    <div id = "dbscan_field"/> 
                    <div id = "random_field"/>
                </div>
        </fieldset>
        
        <fieldset name="best_clustering"><legend>Best Clustering Characterization</legend>
            <table border="0">
                <tbody>
                    <tr>
                        <td>
                            <div>Maximum noise (%)</div>
                        </td>
                        <td>  
                            <input class = "spinner_widget" id="max_noise" value = "15">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div> Minimum number of clusters per clustering:   </div>
                        </td>
                        <td>
                            <input class = "spinner_widget" id="min_clusters" value = "10">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div> Maximum number of clusters per clustering:   </div>
                        </td>
                        <td>
                            <input class = "spinner_widget" id="max_clusters" value = "30">
                        </td>
                    </tr><tr>
                        <td>
                            <div> Minimum cluster size (elements):   </div>
                        </td>
                        <td>
                            <input class = "spinner_widget" id="min_cluster_size" value = "50">
                        </td>
                    </tr>
                    
                    <tr>
                        <td>
                            <div>Add query</div>
                        </td>
                        <td>
                            <select class="selection_widget" id="query_listbox">
                                
                            </select>
                            <div class="button_widget" id = "add_query_button">+</div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input class = "tag_widget" id="query_tags"  type="text">
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <div>Add new evaluation criteria </div> 
                        </td>
                        <td>
                            <div class="button_widget" id = "add_evaluation_criteria_button">+</div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div class="query_container" id = "evaluation_criteria_container_field"/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
    </fieldset>
    
        <div> <label id = "advanced_options_label">Advanced options  <img src="images/collapsed.png" id = "advanced_options_sign"></label> </div>
            <fieldset id="advanced_options_field" hidden="true" name="advanced_params"><legend>Advanced</legend>
                <table border="0">
                    <tbody>
                        <tr>
                            <td>
                                <div>Project root folder:</div>
                            </td>
                            <td>  
                                <input id="working_directory" name="working_directory">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div> Number of processors to use:   </div>
                            </td>
                            <td>
                                <input class = "spinner_widget" id="number_of_processors" >
                            </td>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
        </div>
    </form>
</body>
</html>
